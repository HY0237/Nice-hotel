# ğŸ¤ **Nice Hotel** 

## â” í”„ë¡œì íŠ¸ ê³„ê¸°
ì´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•œ ê³„ê¸°ëŠ” ì›¹ í”„ë¡œê·¸ë˜ë°ì˜ ê¸°ë³¸ ê¸°ìˆ ì¸ ì„œë²„ í”„ë ˆì„ì›Œí¬, ì›¹ ì–¸ì–´ ê·¸ë¦¬ê³  ë°ì´í„°ë² ì´ìŠ¤ë“±ì˜ ê°œë…ì„ ê³µë¶€í•˜ê³  
ê° ê¸°ìˆ ë“¤ì´ ì–´ë–»ê²Œ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ì´ ë˜ëŠ”ì§€ ì´í•´í•˜ê³  ì‹¶ì–´ ë§Œë“¤ì–´ ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì—¬ëŸ¬ ìˆ™ë°• ì˜ˆì•½ ì‚¬ì´íŠ¸ì—ì„œ í˜¸í…”ê³¼ ê°ì‹¤ì„ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì„ ë³´ê³  ì´ì— ê´€í•œ ë°ì´í„° ì¿¼ë¦¬ë„ í•œë²ˆ ë§Œë“¤ì–´ë³´ê³  ì‹¶ì€ ë§ˆìŒë„ ìˆì—ˆìŠµë‹ˆë‹¤. 

## ğŸ™‹â€â™€ï¸ í”„ë¡œì íŠ¸ ì†Œê°œ
ê°„ë‹¨í•œ í˜¸í…” ê°ì‹¤ ì˜ˆì•½ ë° ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì¼ë°˜ì¸ íšŒì›ê³¼ ê´€ë¦¬ìì— ë”°ë¼ ê°ì‹¤ ì˜ˆì•½, ì¡°íšŒ, ê´€ë¦¬ë“±ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ ê¸°ëŠ¥
í”„ë¡œì íŠ¸ì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
![nice_hotelê¸°ëŠ¥](https://user-images.githubusercontent.com/68864993/165903591-3013ddcc-c1ed-44af-9c89-05ed255ea5a4.JPG)

## ğŸ’» ì‚¬ìš©ê¸°ìˆ 
- ### Build Tool
  maven
- ### Language
  Java 11
- ### Framework
  SpringBoot 2.6.4
- ### Database
  MYSQL 8.0.27
- ### Dependencies
  - Spring Web 
  - Spring data JPA 
  - Spring Security 
  - Lombok 1.18.22
  - QueryDSL 5.0.0
  - Thymelaf 
  - Devtools 
  - Modelmapper 2.3.9
  - JUnit 4.13.2
 - ### Front-end
  - html
  - css
  - jquery

 
 ## ğŸ›  DB ì„¤ê³„
 
 ![nice_hotel_ERD](https://user-images.githubusercontent.com/68864993/165909386-eb711ca0-0117-46fa-ba9c-50a610f8a9e4.JPG)
 
 ## ğŸ›  API ì„¤ê³„
 
 <img src="https://user-images.githubusercontent.com/68864993/165914999-318498d4-b9d8-4dd7-b2e0-5ea20b79356d.JPG"  width="800" height="300"/>
 <img src="https://user-images.githubusercontent.com/68864993/165915003-aa8b85bb-a72d-48bb-93ab-dcc24914a6a7.JPG"  width="800" height="250"/>
 <img src="https://user-images.githubusercontent.com/68864993/165915009-10a16953-d590-4e75-97cc-7dd6a098b13b.JPG"  width="800" height="400"/>
 <img src="https://user-images.githubusercontent.com/68864993/165915015-7f404a40-235f-4067-bec4-5acac6b72549.JPG"  width="800" height="200"/>
 
  ## ğŸ–¥ ì‹¤í–‰ í™”ë©´
  ### 1. íšŒì›ê°€ì…
  > ì´ë¦„ ì´ë©”ì¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ íšŒì›ê°€ì…ì„ í•©ë‹ˆë‹¤ (Role ì˜µì…˜ì€ ë‚˜ì¤‘ì— ì§€ìš¸ ì˜ˆì •ì…ë‹ˆë‹¤)
  
![íšŒì›ê°€ì…](https://user-images.githubusercontent.com/68864993/165917462-a4ca9cb1-b43a-41b8-98db-f75c91ed59f2.JPG)

  ### 2. ë¡œê·¸ì¸
  > ìƒì„±í•œ ì´ë©”ì¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ í•©ë‹ˆë‹¤
  
![ë¡œê·¸ì¸ í™”ë©´](https://user-images.githubusercontent.com/68864993/165917470-04cde126-db39-4213-97ae-9d58d368fb85.JPG)


  ### 3. ì‚¬ìš©ììš© í™ˆ
  > ì²´í¬ì¸, ì²´í¬ì•„ì›ƒ, ê²ŒìŠ¤íŠ¸ ìˆ˜ì˜ ì˜µì…˜ê³¼ ê°ì‹¤ ì´ë¦„ì„ ê²€ìƒ‰í•´ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¡°íšŒí•œ ê°ì‹¤ì„ ì„ íƒí•´ ì˜ˆì•½ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
![ì‚¬ìš©ììš©MAIN](https://user-images.githubusercontent.com/68864993/165920088-93255e41-a9bc-4c79-9fc0-6f4914022d9c.JPG)

  ### 4. ì˜ˆì•½ í˜ì´ì§€
  > ì´ë¦„, ì´ë©”ì¼, ê²ŒìŠ¤íŠ¸ ìˆ˜ë¥¼ ì…ë ¥í•´ ê°ì‹¤ì„ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²´í¬ì¸ ì²´í¬ì•„ì›ƒ ë‚ ì§œëŠ” ê¸°ì¡´ì˜ ë©”ì¸ í˜ì´ì§€ì—ì„œ ë„£ì—ˆë˜ ì¡°ê±´ì„ ë„£ì–´ ë°˜ì˜í•˜ì˜€ìŠµë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ ìˆ˜ëŠ” ìµœëŒ€ ê°ì‹¤ ì¸ì› ìˆ˜ ì´í•˜ë¡œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
  
![ì˜ˆì•½í˜ì´ì§€](https://user-images.githubusercontent.com/68864993/165920778-f8e4d1b2-fab4-4854-b5c2-9d55f8886d9f.JPG)

  ### 5. ì˜ˆì•½ ë‚´ì—­
  > ì˜ˆì•½í•œ ê°ì‹¤ì„ í™•ì¸í•˜ê³  ì˜ˆì•½ì„ ì·¨ì†Œë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
![íšŒì›ì˜ˆì•½ê°ì‹¤ì¡°íšŒ](https://user-images.githubusercontent.com/68864993/165920417-71bb7f6a-c864-4e34-92cd-3674dc4b58d9.JPG)

  ### 6. ê´€ë¦¬ììš© í™ˆ
  > ì‚¬ìš©ìì™€ ê°™ì´ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ì„ ì¡°íšŒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¼ìª½ ë©”ë‰´ì—ëŠ” íšŒì›, ê°ì‹¤, ì˜ˆì•½ì„ ì¡°íšŒ í•  ìˆ˜ ìˆëŠ” ë²„íŠ¼ë“¤ì´ ìˆìŠµë‹ˆë‹¤.
  
![niceHotel_mainPage](https://user-images.githubusercontent.com/68864993/165918471-efcac35a-9714-4f75-8a57-93e640287008.JPG)

  ### 7. ê´€ë¦¬ììš© íšŒì› ê´€ë¦¬
  > ë“±ë¡ ê¸°ê°„, íšŒì› ì´ë¦„, ì´ë©”ì¼ ì˜µì…˜ì„ ë„£ì–´ íšŒì›ì„ ì¡°íšŒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° íšŒì›ë‹˜ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
![íšŒì› ì¡°íšŒ](https://user-images.githubusercontent.com/68864993/165922182-1edb50a2-abb1-4a11-953c-a65a53fa023d.JPG)

  ### 8. ê´€ë¦¬ììš© ê°ì‹¤ ê´€ë¦¬ 
  > ë“±ë¡ ê¸°ê°„, ê°ì‹¤ íƒ€ì…, ê°ì‹¤ ì´ë¦„ ì˜µì…˜ì„ ë„£ì–´ ê°ì‹¤ì„ ì¡°íšŒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ì‹¤ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
![ê°ì‹¤ ì¡°íšŒ](https://user-images.githubusercontent.com/68864993/165922555-72d1d409-130e-47b8-8de3-7a2b894061ba.JPG)

  ### 6. ê´€ë¦¬ììš© ì˜ˆì•½ ê´€ë¦¬ 
  > ë“±ë¡ ê¸°ê°„, ê°ì‹¤ íƒ€ì…, íšŒì› ì´ë¦„, íšŒì› ë©”ì¼ ì˜µì…˜ì„ ë„£ì–´ ì˜ˆì•½ì„ ì¡°íšŒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆì•½ì„ ì¶”ê°€ ë˜ëŠ” ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
![ì˜ˆì•½ ì¡°íšŒ](https://user-images.githubusercontent.com/68864993/165924536-747ea897-7cf7-4ff3-bdca-825018dc0b94.JPG)


  ## SpringBoot (API Server)
  >  apië¥¼ ë§Œë“¤ê¸° ìœ„í•´ ê³„ì¸µë³„ë¡œ 7ê°€ì§€ íŒ¨í‚¤ì§€ì˜ êµ¬ì¡°ë¡œ ë‚˜íƒ€ëƒˆìŠµë‹ˆë‹¤.
  
  êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
  - config: project configurationì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - controller: ì™¸ë¶€ ìš”ì²­ê³¼ ì‘ë‹µ APIë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - service: Domainì— ì •ì˜í•œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ í˜¸ì¶œ ìˆœì„œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - entity: Domain modelì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - constant: ìƒìˆ˜ enum íƒ€ì…ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - dto: ë°ì´í„° êµí™˜ì„ ìœ„í•œ ê°ì²´ë“¤ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
  - repository: JPA + QueryDSLë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
  

  ### ë°°ìš´ ì  ğŸ“š 
  - Serviceì—ì„œ loombokì˜ @RequiredArgsContructorë¥¼ ì‚¬ìš©í•´ finalì´ ì„ ì–¸ëœ ëª¨ë“  í•„ë“œë¥¼ ì¸ìê°’ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìƒì„±ì ì½”ë“œë¥¼ ê³„ì†í•´ì„œ ìˆ˜ì •í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - Service í´ë˜ìŠ¤ì— @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•´ ë¡œì§ì„ ì²˜ë¦¬í•˜ë‹¤ê°€ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë¡œì§ì„ ìˆ˜í–‰í•˜ê¸° ì´ì „ ìƒíƒœë¡œ ì½œë°±ì‹œì¼œì¤ë‹ˆë‹¤.
  - Entity í´ë˜ìŠ¤ë¥¼ Request/Response í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡! ê·¸ ì´ìœ ëŠ” Entity í´ë˜ìŠ¤ëŠ” ë°ì´í„° ë² ì´ìŠ¤ì™€ ë§ë‹¿ì€ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  - update ê¸°ëŠ¥ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— Update ì¿¼ë¦¬ë¥¼ ë‚ ë¦´ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” JPAì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ í™˜ê²½ìœ¼ë¡œ ì¸í•´ ë°ì´í„°ì˜ ê°’ì´ ë³€ê²½í•˜ë©´ íŠ¸ëœì­ì…˜ì´ ëë‚˜ëŠ” ì‹œì ì— í•´ë‹¹ í…Œì´ë¸”ì— ë³€ê²½ë¶„ì„ ë°˜ì˜í•©ë‹ˆë‹¤.
    ```
        public Long updateClient(ClientDto clientDto){
          Member member = memberRepository.findById(clientDto.getId()).orElseThrow(EntityExistsException::new);
          member.updateClient(clientDto);
          return member.getId();
         }
    ```
- @DateTimeFormateì´ë¼ëŠ” ìŠ¤í”„ë§ì—ì„œ ì§€ì›í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ ë‚ ì§œ ê´€ë ¨ íƒ€ì… ë°ì´í„°ë¥¼ ì‰½ê²Œ ì§ë ¬í™”í•˜ê³  ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„í•´ì„œ ë°ì´í„°ë¥¼ ì…ë ¥ ë°›ì•„ ì˜¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
  ```
    @DateTimeFormat(pattern = "yyyy-MM-dd")
    private LocalDate checkIn;

    @DateTimeFormat(pattern = "yyyy-MM-dd")
    private LocalDate checkOut;
    
   ```


## Spring Security
  > security ì¸ì¦, ì¸ê°€ ì„¤ì •ì„ ì¶”ê°€í•´ íšŒì›ê°€ì… ë¡œê·¸ì¸ì„ êµ¬í˜„í•´ ë³´ê³  ê´€ë¦¬ì í˜ì´ì§€ì— ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 
  - ì¸ì¦ì´ í•„ìš”ì—†ëŠ” ê²½ìš° : ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ ì¡°íšŒ
  - ì¸ì¦ì´ í•„ìš”í•œ ê²½ìš° : ê°ì‹¤ ì˜ˆì•½, ì˜ˆì•½ ìƒì„¸ë³´ê¸°
  - ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•œ ê²½ìš° : ê°ì‹¤ ë“±ë¡, ìˆ˜ì •, ì¡°íšŒí•˜ê¸°, íšŒì› ìˆ˜ì •, ì¡°íšŒí•˜ê¸°, ì˜ˆì•½ ì¡°íšŒí•˜ê¸° 

 ### ë°°ìš´ ì  ğŸ“š
- permitAll()ì„ í†µí•´ ì‚¬ìš©ìê°€ ì¸ì¦ì—†ì´ í•´ë‹¹ ê²½ë¡œì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ "/admin"ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ê²½ë¡œëŠ”   í•´ë‹¹ ê³„ì •ì´ ADMIN Roleì¼ ê²½ìš°ì¼ë•Œë§Œ ì ‘ê·¼ ê°€ëŠ¥ í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
    ```
        http.authorizeRequests()
                .mvcMatchers("/**", "/reservation/**", "/members/**", "/room/**","/images/**").permitAll()
                .mvcMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated();
    ```
- static ë””ë ‰í„°ë¦¬ì˜ í•˜ìœ„ íŒŒì¼ì€ ì¸ì¦ì„ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
    ```
        @Override
        public void configure(WebSecurity web) throws Exception {
            web.ignoring().antMatchers("/assets/**","/forms/**","/img/**");
        }
    ```

- spring securityë¥¼ ì‚¬ìš©í•  ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ CSRFë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ ëª¨ë“  POST ë°©ì‹ì˜ ë°ì´í„° ì „ì†¡ì— CSRF í† í° ê°’ì„ ë³´ë‚´ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.
    ```
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    ```
    ```
        var token = $("meta[name='_csrf']").attr("content");
         var header = $("meta[name='_csrf_header']").attr("content");
                  ...
        $.ajax({
            url      : url,
            type     : "POST",
            contentType : "application/json",
            data     : param,
            beforeSend : function(xhr){
             /* ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì • */
               xhr.setRequestHeader(header, token);
            },
            dataType : "json",
            cache   : false,
            success  : function(result, status){
            alert("ì˜ˆì•½ì´ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.href='/';
            }
        });
    ```

 ## JPA 
  > ORMì„ ìœ„í•´ ìë°”ì—ì„œ ì œê³µí•˜ëŠ” API, ë°˜ë³µì ì¸ CRUD ì‘ì—…ì„ ëŒ€ì²´í•´ DBì—ì„œ ê°„ë‹¨í•œ ë°ì´í„°ë¥¼ ì¡°íšŒ í•©ë‹ˆë‹¤.
  
-  SpringDataJpaì—ì„œ ì œê³µí•˜ì§€ ì•ŠëŠ” ë©”ì†Œë“œëŠ” @Queryë¥¼ ì‘ì„±í•˜ì—¬ ì‚¬ìš©í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
      ```
            @Query("select r from Reservation r "+
                    "where r.member.email = :email "+
                    "order by r.regTime desc")
            List<Reservation> findReservations(@Param("email") String email, Pageable pageable);
        
            @Query("select count(r) from Reservation r "+
                    "where r.member.email = :email ")
            Long countReservation(@Param("email") String email);
      ```
    
  ### JPAì˜ Auditing
   > ê°ì‹¤, ì˜ˆì•½, ë©¤ë²„ ì—”í‹°í‹°ê°€ ì €ì¥ ë˜ëŠ” ìˆ˜ì •ë  ë•Œ ìë™ìœ¼ë¡œ ë“±ë¡ì¼, ìˆ˜ì •ì¼, ë“±ë¡ì, ìˆ˜ì •ìë¥¼ ì…ë ¥í•´ ì¤ë‹ˆë‹¤.

   - BaseTimeEntity class: ë“±ë¡ì¼ @CreatedDate ìˆ˜ì •ì¼ @LastModifiedDateë¥¼ ì—”í‹°í‹°ê°€ ìƒì„± ë³€ê²½ ë ë•Œ ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
   - BaseEntity: BaseTimeEntityë¥¼ ìƒì† ë°›ìœ¼ë©° ë“±ë¡ì @CreatBy ìˆ˜ì •ì @LastModifedByë¥¼ ì—”í‹°í‹°ê°€ ìƒì„± ë³€ê²½ ë ë•Œ ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
   - Room, Reservation, Member ì—”í‹°í‹°ëŠ” BaseEntity í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì•˜ìŠµë‹ˆë‹¤.


  
 ## QueryDSL
 > JPAë¡œ í•´ê²° í•  ìˆ˜ ì—†ëŠ” ë³µì¡í•œ ì¿¼ë¦¬ëŠ” QueryDSLë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

 - ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ì„ ì¡°íšŒ í• ë•Œ
    - êµ¬ì¡°
        - Reservation (Domain Class)
        - ReservationRespository (JPA interface)
        - ReservationRepositoryCustom (QueryDSL interface)
        - ReservationRepositoryCustomImpl (QueryDSL implements Class)
        
    - QueryDSLë¡œ êµ¬í˜„í•˜ê¸° ì „ Mysql workbenchë¡œ ì—¬ëŸ¬ ì²´í¬ì¸ ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ë„£ì–´ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆ˜ì •í•˜ë©° ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
    ``` sql
                select * from room where room_id not in (select room_id from reservation 
                where ('2022-04-10' <= Date(check_in) and  Date(check_in) < '2022-04-11')
                or ('2022-04-10' <  Date(check_out) and  Date(check_out) <= '2022-04-11')
                or( Date(check_in) < '2022-04-10' and '2022-04-11' < Date(check_out)));
    ```
    - ì‚¬ìš©ìê°€ ë„£ì€ checkInê³¼ checkOutì— ë”°ë¼ì„œ ë‹¤ë¥¸ ì˜ˆì•½ ë‚ ì§œë¥¼ ë¹„êµí•´ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ ì¡°íšŒí•˜ë„ë¡ ì¡°ê±´ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    ```
            private BooleanExpression searchDate(LocalDate checkIn, LocalDate checkOut){
        
                LocalDate checkInDefault = LocalDate.now();
                LocalDate checkOutDefault = LocalDate.now().plusDays(1);
                
                // ì²´í¬ì¸ ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ë„£ì§€ ì•Šì•˜ì„ ë•Œ ì˜¤ëŠ˜ê³¼ ë‚´ì¼ ë‚ ì§œë¡œ default í•´ì„œ ë„£ê¸°
                if(checkIn == null && checkOut == null){
                    checkIn = checkInDefault;
                    checkOut = checkOutDefault;
                }
                /**
                 *  case 1 : checkIn <= QcheckIn and QcheckIn < checkOut 
                 *  ì˜ˆì•½í•œ ì²´í¬ì¸ ë‚ ì§œê°€ ì‚¬ìš©ê°€ ë„£ì€ ê²€ìƒ‰ ì¼ì§œ ì‚¬ì´ì— ìˆì„ ë•Œ 
                 */
                BooleanExpression case1 =
                        QReservation.reservation.checkIn.goe(checkIn)
                                .and(QReservation.reservation.checkIn.lt(checkOut));
                /**
                 *  case 2 : checkIn <= QcheckOut and QcheckOut < checkOut 
                 *  ì˜ˆì•½í•œ ì²´í¬ì•„ì›ƒ ë‚ ì§œê°€ ì‚¬ìš©ê°€ ë„£ì€ ê²€ìƒ‰ ì¼ì§œ ì‚¬ì´ì— ìˆì„ ë•Œ 
                 */
                BooleanExpression case2 =
                        QReservation.reservation.checkOut.gt(checkIn)
                                .and(QReservation.reservation.checkOut.loe(checkOut));
                /**
                 *  case 3 : QcheckIn < checkIn and checkOut  < QcheckOut 
                 *  ì˜ˆì•½í•œ ì²´í¬ì¸ ì²´í¬ì•„ì›ƒ ê¸°ê°„ ì•ˆì— ì‚¬ìš©ê°€ ë„£ì€ ê²€ìƒ‰ ì¼ì§œê°€ ìˆì„ ë•Œ 
                 */
                BooleanExpression case3 =
                        QReservation.reservation.checkIn.lt(checkIn)
                                .and(QReservation.reservation.checkOut.gt(checkOut));
        
                return case1.or(case2).or(case3);
    }
    ```
    - ì‚¬ìš©ìê°€ ë„£ì€ guest ìˆ˜ì— ë”°ë¼ ê°ì‹¤ì˜ ìµœëŒ€ ì¸ì›ìˆ˜ë¥¼ ë¹„êµí•´ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ì„ ì¡°íšŒí•˜ë„ë¡ ì¡°ê±´ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤
    ```
            private BooleanExpression searchMaxGuest(Integer guest){
                return guest == null? QRoom.room.maxPeople.goe(1): QRoom.room.maxPeople.goe(guest);
            }
    ```
    - ê°ì‹¤ ì´ë¦„ì— ì‚¬ìš©ìê°€ ë„£ì€ ê²€ìƒ‰ì–´ê°€ í¬í•¨í•˜ëŠ” ê°ì‹¤ì„ ì¡°íšŒí•˜ë„ë¡ ì¡°ê±´ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤
    ```
            private BooleanExpression searchRoomByName(String searchQuery){
                return StringUtils.isEmpty(searchQuery) ? null : QRoom.room.roomNm.like("%" + searchQuery + "%");
             }
    ```
    - ì‚¬ìš©ìê°€ ë„£ì€ ë‚ ì§œ, ê²ŒìŠ¤íŠ¸ ìˆ˜, ê°ì‹¤ ì´ë¦„ ì¡°ê±´ìœ¼ë¡œ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ ì¡°íšŒí•˜ë„ë¡ ì¶œë ¥í•©ë‹ˆë‹¤.
    ```
        @Override
        public Page<ReservationMainDto> getReserveRoomPage(RoomSearchDto roomSearchDto, Pageable pageable) {
            QRoom room = QRoom.room;
            QRoomImg roomImg = QRoomImg.roomImg;
            QReservation reservation = QReservation.reservation;
    
            List<ReservationMainDto> contents = queryFactory
                    .select(
                            new QReservationMainDto(
                                    room.id,
                                    room.roomNm,
                                    room.roomType,
                                    room.pricePerNight,
                                    room.maxPeople,
                                    roomImg.imgUrl))
                    .from(roomImg)
                    .join(roomImg.room(), room) // roomê³¼ roomImg í…Œì´ë¸” ì¡°ì¸
                    .where(room.id.notIn( // reservation í…Œì´ë¸” ì—ì„œ ì˜ˆì•½ ê°€ëŠ¥í•œ room ì•„ì´ë”” ì¡°íšŒ
                            JPAExpressions
                                    .select(reservation.room().id)
                                    .from(reservation)
                                    .where(searchDate(roomSearchDto.getSearchCheckIn(), // ì˜ˆì•½ ë‚ ì§œ ì¡°ê±´
                                            roomSearchDto.getSearchCheckOut()))),
                            roomImg.repimgYn.eq("Y"), // ëŒ€í‘œ ì´ë¯¸ì§€ ì¡°ê±´
                            searchRoomByName(roomSearchDto.getSearchQuery()), // ê°ì‹¤ ì´ë¦„ ì¡°ê±´
                            searchMaxGuest(roomSearchDto.getSearchAdults())) // ê²ŒìŠ¤íŠ¸ ìˆ˜ ì¡°ê±´
                    .orderBy(room.id.desc())
                    .offset(pageable.getOffset())
                    .limit(pageable.getPageSize())
                    .fetch();
            
            long total = contents.size();
            return new PageImpl<>(contents, pageable, total);
    }
    ```
    

 ## Modelmapper
   > Object fieldê°’ì„ getter, setterë¥¼ í†µí•´ ê°’ì„ ë³µì‚¬í•´ì„œ ë‹¤ë¥¸ ê°ì²´ì— ë°˜í™˜í•´ì¤ë‹ˆë‹¤
   - Room DTO ê°ì²´ì™€ Room ì—”í‹°í‹° ê°ì²´ê°„ì˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ ë³µì‚¬í•œ ê°ì²´ë¥¼ ì„œë¡œ ë°˜í™˜í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. 
       ```
           private static ModelMapper modelMapper = new ModelMapper();
           
           public Room createRoom() {
                        return modelMapper.map(this, Room.class);
            }
            public static RoomFormDto of(Room room){
                return modelMapper.map(room, RoomFormDto.class);
            }
       ```
       
 ## JQuery
   > HTML ë¬¸ì„œì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ê³  Ajax ë©”ì†Œë“œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ë³´ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
   
   - Jqueryë¡œ í˜ì´ì§€ ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
       ```
       function page(page){
                  var searchQuery = $("#searchQuery").val();
                  var checkIn = $("#checkIn").val();
                  var checkOut = $("#checkOut").val();
                  var guest = $("#searchAdults").val();
    
                  location.href="/" + page
                  + "?searchQuery=" + searchQuery
                  + "&searchCheckIn=" + checkIn
                  + "&searchCheckOut=" + checkOut
                  + "&searchAdults=" + guest;
              }
       ```
   - Post Ajaxë¡œ ì˜ˆì•½ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
       ```
       function reservation(){
              var token = $("meta[name='_csrf']").attr("content");
              var header = $("meta[name='_csrf_header']").attr("content");

              var url = "/reservation/new";
              var paramData = {
                  checkIn : $("#checkin").val(),
                  checkOut : $("#checkout").val(),
                  price : $("#totalPrice").val(),
                  guest : $("#guests").val(),
                  roomId : $("#roomId").val(),
                  name : $("#name").val(),
                  email : $("#email").val()
              };

              var param = JSON.stringify(paramData);

              $.ajax({
                  url      : url,
                  type     : "POST",
                  contentType : "application/json",
                  data     : param,
                  beforeSend : function(xhr){
                      /* ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì • */
                      xhr.setRequestHeader(header, token);
                  },
                  dataType : "json",
                  cache   : false,
                  success  : function(result, status){
                      alert("ì˜ˆì•½ì´ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                      location.href='/';
                  }
              });
            }
       ```
- ìˆ™ë°• ê¸°ê°„ì— ë”°ë¥¸ ì´ ê²°ì œ ê¸ˆì•¡ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
    ```
            function calculateTotalPrice(){

              var date1 = new Date($("#checkin").val());
              var date2 = new Date($("#checkout").val());

              var Difference_In_Time = date2.getTime() - date1.getTime();
              var nights = Difference_In_Time / (1000 * 3600 * 24);

              var price = $("#pricePerNight").val();
              var totalPrice = price*nights;
              $("#totalPrice").val(totalPrice);
              $("#totalPriceH").html(totalPrice + 'ì›');
              $("#nights").html(nights);

            } 
    ```
   
## JUnit 4 (Test)
   > H2 ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ Layer ë³„ ë¡œì§ì— ì§‘ì¤‘í•´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
   - Domain í…ŒìŠ¤íŠ¸: Entity í´ë˜ìŠ¤ë“¤ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ updateClient, updateRoomë“±ì˜ ë©”ì†Œë“œì„ í…ŒìŠ¤íŠ¸ í–ˆìŠµë‹ˆë‹¤.
        ```
            @Test
            @DisplayName("ê°ì‹¤ ìˆ˜ì • í…ŒìŠ¤íŠ¸")
            void updateRoom_test(){
    
                RoomFormDto roomFormDto = new RoomFormDto();
                roomFormDto.setRoomNm("test10");
                roomFormDto.setRoomType(RoomType.DOUBLE);
                roomFormDto.setRoomDetail("testtestest");
                roomFormDto.setMaxPeople(4);
                roomFormDto.setPricePerNight(3000);
        
                room.updateRoom(roomFormDto);
        
                Assertions.assertEquals(roomFormDto.getRoomNm(), room.getRoomNm());
                Assertions.assertEquals(roomFormDto.getRoomType(), room.getRoomType());
                Assertions.assertEquals(roomFormDto.getRoomDetail(), room.getRoomDetail());
                Assertions.assertEquals(roomFormDto.getMaxPeople(), room.getMaxPeople());
                Assertions.assertEquals(roomFormDto.getPricePerNight(), room.getPricePerNight());
            
            }
        ```
   - Repository í…ŒìŠ¤íŠ¸: Repositoryì•ˆì— ìˆëŠ” Jpa, QueryDSL ì¿¼ë¦¬ë“¤ì„ í…ŒìŠ¤íŠ¸ í–ˆìŠµë‹ˆë‹¤.
        ```
            @Test
            @DisplayName("ê°ì‹¤ ì €ì¥ í…ŒìŠ¤íŠ¸")
            void createRoomTest(){
                Room room = new Room();
                room.setRoomNm("í…ŒìŠ¤íŠ¸ ê°ì‹¤");
                room.setPricePerNight(40000);
                room.setRoomDetail("ê°ì‹¤ ìƒì„¸ ì„¤ëª…");
                room.setRoomType(RoomType.SINGLE);
                room.setRegTime(LocalDateTime.now());
                room.setUpdateTime(LocalDateTime.now());
                Room savedRoom = roomRepository.save(room);
                System.out.println(savedRoom.toString());
            }
        ```
   - Service í…ŒìŠ¤íŠ¸: @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ í…ŒìŠ¤íŠ¸í›„ DBë¥¼ ìë™ìœ¼ë¡œ Rollback í•˜ì˜€ìŠµë‹ˆë‹¤.
        ```
            @SpringBootTest
            @Transactional
            @TestPropertySource(locations = {"classpath:application-test.properties"})
            class RoomServiceTest {
                  ...
                  
                  @Test
                  @DisplayName("ê°ì‹¤ ì‚­ì œ í…ŒìŠ¤íŠ¸")
                  @WithMockUser(username = "admin", roles = {"ADMIN"})
                  void deleteRoom() throws Exception {
                      this.createRoomList();
                      roomService.deleteRoom(1L);
                      Assertions.assertThat(roomRepository.findById(1L)).isEmpty();
                  }
            }
       ```
   - Controller í…ŒìŠ¤íŠ¸: @withMockUserì„ ì‚¬ìš©í•˜ì—¬ ê¶Œí•œì„ í…ŒìŠ¤íŠ¸ í•´ë³´ê³  MockMvcë¥¼ ì´ìš©í•´ GET, POST, DELETE apië¥¼ í…ŒìŠ¤íŠ¸ í•˜ì˜€ìŠµë‹ˆë‹¤.
       ```
                @Test
                @DisplayName("ê°ì‹¤ ì˜ˆì•½ í…ŒìŠ¤íŠ¸")
                @WithMockUser(username = "test@test.com", roles = "USER")
                void reservationNew_test() throws Exception{
                    Member member = this.saveMember();
                    Long roomId = this.createRoom();

                    ReservationDto reservationDto = new ReservationDto();
                    reservationDto.setEmail(member.getEmail());
                    reservationDto.setName(member.getName());
                    reservationDto.setCheckIn(LocalDate.now());
                    reservationDto.setCheckOut(LocalDate.now());
                    reservationDto.setGuest(3);
                    reservationDto.setPrice(10000);
                    reservationDto.setRoomId(roomId);


                    mockMvc.perform(MockMvcRequestBuilders.post("/reservation/new/")
                                    .contentType(MediaType.APPLICATION_JSON)
                                    .content(objectMapper.writeValueAsString(reservationDto))
                                    .with(csrf()))

                            .andDo(print())
                            .andExpect(status().isOk());
                }
        
       ```
       
   
  - ğŸ”‘ ì´ 54ê°œì˜ Test Caseë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. (Domain : 6 / Repository : 10 / Service : 14 / Controller : 24)
    
  ## References
   - ë°±ê²¬ë¶ˆì—¬ì¼íƒ€ ìŠ¤í”„ë§ë¶€íŠ¸ ì‡¼í•‘ëª° í”„ë¡œì íŠ¸ with JPA
   - ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤
   - Nice Admin -Free bootstrap admin HTML template
  
 ## í”„ë¡œì íŠ¸ì— ì¶”ê°€í•  ê¸°ëŠ¥
   - OAuth + JWT êµ¬ê¸€ í˜ì´ìŠ¤ë¶ ë¡œê·¸ì¸ ê¸°ëŠ¥ ë„£ê¸°
   - spring batchë¡œ í•˜ë£¨ ì „ ì˜ˆì•½ ì•Œë¦¼ ê¸°ëŠ¥ ë„£ê¸°
   - Jenkinsì™€ Codedeployë¡œ  CI/CD êµ¬í˜„í•˜ê¸°
   - AWSì— ë¬´ì¤‘ë‹¨ ë°°í¬ í•˜ê¸°
 

 
